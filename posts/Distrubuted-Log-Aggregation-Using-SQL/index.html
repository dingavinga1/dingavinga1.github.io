<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Distrubuted Log Aggregation Using SQL" /><meta property="og:locale" content="en" /><meta name="description" content="I was talking to a friend recently and she happens to be a performance test engineer. It had been a stressful day for her because it took her an entire day to analyze some performance results. You might be wondering:" /><meta property="og:description" content="I was talking to a friend recently and she happens to be a performance test engineer. It had been a stressful day for her because it took her an entire day to analyze some performance results. You might be wondering:" /><link rel="canonical" href="https://dingavinga1.github.io/posts/Distrubuted-Log-Aggregation-Using-SQL/" /><meta property="og:url" content="https://dingavinga1.github.io/posts/Distrubuted-Log-Aggregation-Using-SQL/" /><meta property="og:site_name" content="Abdullah Irfan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-25T02:00:00+05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Distrubuted Log Aggregation Using SQL" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-25T02:00:00+05:00","datePublished":"2024-11-25T02:00:00+05:00","description":"I was talking to a friend recently and she happens to be a performance test engineer. It had been a stressful day for her because it took her an entire day to analyze some performance results. You might be wondering:","headline":"Distrubuted Log Aggregation Using SQL","mainEntityOfPage":{"@type":"WebPage","@id":"https://dingavinga1.github.io/posts/Distrubuted-Log-Aggregation-Using-SQL/"},"url":"https://dingavinga1.github.io/posts/Distrubuted-Log-Aggregation-Using-SQL/"}</script><title>Distrubuted Log Aggregation Using SQL | Abdullah Irfan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Abdullah Irfan"><meta name="application-name" content="Abdullah Irfan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Abdullah Irfan</a></div><div class="site-subtitle font-italic">AI Data Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/dingavinga1" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['abdullahirfan2001','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://linkedin.com/in/dingavinga" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Distrubuted Log Aggregation Using SQL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Distrubuted Log Aggregation Using SQL</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1732482000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 25, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/dingavinga1">Abdullah Irfan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1863 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>I was talking to a friend recently and she happens to be a performance test engineer. It had been a stressful day for her because it took her an entire day to analyze some performance results. You might be wondering:</p><blockquote><p>Sure, it takes time to actually run performance tests but how can it take an entire day to analyze the results?</p></blockquote><p>Well, I must admit that the “taking the entire day” part is a bit of an exaggeration. But it was taking way more time than it should have. Let me explain how.</p><p>The project she’s working on is a multi-tenant, multi-user setup where each tenant “owns” multiple IoT devices. Since those tenants mostly have geographically distributed edge devices, each edge device in a particular geographical region communicates with the tenant via “regional nodes”. In our context, that means each regional node collects logs from the edge devices in its scope, combines them, and sends them down to the tenant.</p><p>Here’s how I imagined it:</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*br4nVuQt_j-BrMXf" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*br4nVuQt_j-BrMXf" alt="Geographical Distrubution of the Setup" class="lazyload" data-proofer-ignore></a></p><p>My friend had to target the following scenario:</p><ul><li>Edge devices poll for highly specific content, which is always <em>1048000</em> bytes in size<li>For each polling request, an edge device logs the response size and response time<li>These logs are being sent to the corresponding regional node<li>Each regional node is configured to send back these logs (in CSV format) to the tenant in batches</ul><p>The real test, however, was <em>simulating numerous edge devices from around the world simultaneously hitting this API.</em></p><p>After much consideration, beyond the scope of this blog, her team put together a distributed test setup on AWS, to imitate this behavior.</p><p>They’re now using:</p><ul><li>EC2 instances representing regional nodes<li>Docker containers, running in each AWS EC2 instance, representing edge devices<li>Each Docker container starts up with a script to make an <code class="language-plaintext highlighter-rouge">n</code> number of polling requests to the API server, record the response size and time, and provide them to their host instance<li>Each AWS EC2 instance, in return, uploads these logs to a shared Amazon S3 bucket.</ul><p><a href="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*LR25tZAvdSkIvzmOQG_cgg.png" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*LR25tZAvdSkIvzmOQG_cgg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>After the test, our Amazon S3 bucket supposedly had hundreds of CSV files that look like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>response_size,response_time
1048000,533.92
1048000,548.34
1048000,527.13
1048000,544.23
1048000,580.05
1048000,570.71
...
...
...
</pre></table></code></div></div><p>If you’ve made it this far, you deserve to know the real challenge. Here’s the task my friend’s boss assigned her, based on the test results:</p><blockquote><p>Given these several hundred files with identical schemas, calculate the average response time for a successful polling request to the API server.</p></blockquote><p>My approach would have been the tedious manual route: opening each file in Microsoft Excel, calculating averages, and then a cumulative average across all files. But my clever friend found a much more efficient solution. Here’s what she did:</p><ul><li>Run a script to download all objects from the S3 bucket into a folder<li>Run another script to combine all CSV files into one giant CSV file<li>Run an Excel formula to calculate the average response time ONLY for the records that have a response size of exactly 1048000 bytes.</ul><p>With my brand-new AWS knowledge and eagerness to put some of my data engineering skills to the test, I decided to make this even simpler for her.</p><p>By the way, did you know you can query data from within “objects” using SQL? Well, I didn’t but I guess you learn something new everyday.</p><p>Before we jump into the AWS solution, let me introduce you to a service that I just discovered while developing my solution, and that is… Apache Hive (Hive).</p><blockquote><p>Apache Hive is a data warehouse software project. It is built on top of Apache Hadoop for providing data queries and analysis. Hive gives an SQL-like interface to query data stored in various databases and file systems that integrate with Hadoop. Apache Hive supports the analysis of large datasets stored in Hadoop’s HDFS and compatible file systems such as Amazon S3 filesystem and Alluxio. It provides a SQL-like query language called HiveQL with schema on read and transparently converts queries to MapReduce, Apache Tez, and Spark jobs.</p></blockquote><p>Wow! Just wow! Honestly, those guys on LinkedIn who go around saying <strong>“SQL is used everywhere”</strong> are not wrong. Apache Hive is open-source software that is literally made to provide a central querying interface for transactional databases as well as traditional file stores. So, wherever there’s a schema, Hive can let you query data using SQL, or as I should say — HiveQL.</p><p>Although Hive is pretty awesome, it is important to note that deploying Hive isn’t an easy task and requires strong operational overhead. It’s wouldn’t be cost-effective for a scenario like ours. So, what would be cost-effective? Is it something named after a Greek goddess with infinite wisdom?</p><p>Yes! It’s Amazon Athena! It’s crazy to think that just a month ago, I didn’t even know this service existed and now I advocate it to everyone, from colleagues at work to my 60-year-old grandfather who just learned how to SUM a column in Excel. It’s for good reason though. Amazon Athena is a serverless, fully managed service from AWS, that allows you to query your Amazon S3 buckets and AWS Glue catalog databases, using SQL. And no, we’re not talking about some modified version of SQL called HiveQL or Amazon AthenaQL. Amazon Athena allows you to use traditional SQL — the one we all know and love!</p><p>So how did Amazon Athena save the day? We already have an Amazon S3 bucket with countless files containing possibly millions of records right? Well, we can use another AWS service called AWS Glue, to create a “crawler”, that will go through the entire Amazon S3 bucket, infer each file’s schema and create tables for all schemas. Let’s do it!</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKnYNuOJUPsQwDJ6v_MDSg.png" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKnYNuOJUPsQwDJ6v_MDSg.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Alright, now let’s dive into the AWS Console and search for AWS Glue.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eKx8Rwv1j_Ar40J3" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eKx8Rwv1j_Ar40J3" alt="Search for AWS Glue" class="lazyload" data-proofer-ignore></a></p><p>Now, let’s click on <code class="language-plaintext highlighter-rouge">Crawlers</code> under the <code class="language-plaintext highlighter-rouge">Data Catalog</code> section of the AWS Glue console.</p><p><a href="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*KXYSRQpDjQNz-mzb" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*KXYSRQpDjQNz-mzb" alt="Click crawler" class="lazyload" data-proofer-ignore></a></p><p>Click on <code class="language-plaintext highlighter-rouge">Create Crawler</code> in the top right.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sUdJ5J_7p7BpnQlx" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sUdJ5J_7p7BpnQlx" alt="New Crawler Button" class="lazyload" data-proofer-ignore></a></p><p>Let’s go through the process of creating our crawler:</p><h3 id="step-1---crawler-properties"><span class="mr-2">Step 1 - Crawler Properties</span><a href="#step-1---crawler-properties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Configure the name, description, and tags for your crawler</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X-tlvC0qFAkXLB0n" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X-tlvC0qFAkXLB0n" alt="Crawler Properties" class="lazyload" data-proofer-ignore></a></p><h3 id="step-2--data-source"><span class="mr-2">Step 2 — Data Source</span><a href="#step-2--data-source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Configure the data source for the crawler i.e. our Amazon S3 bucket. As for the configuration, since we know that all our data follows a fixed schema, we can manually create a AWS Glue catalog table to map our crawler to. However, to fully demonstrate the capabilities of our crawler (which is inferring schemas from the files themselves), we’ll go with <code class="language-plaintext highlighter-rouge">Not yet</code> and we’ll add our Amazon S3 bucket (or folder) as a data source.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NDiLjq-R-oWGwVOJ" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NDiLjq-R-oWGwVOJ" alt="Crawler Data Source" class="lazyload" data-proofer-ignore></a></p><h3 id="step-3---configuring-crawler-security"><span class="mr-2">Step 3 - Configuring Crawler Security</span><a href="#step-3---configuring-crawler-security" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First off, we need to create a AWS Glue service role and assign it to the crawler for it to work. On this page, we can also configure encryption at rest for the AWS Cloudwatch logs pushed by our crawler but there’s no need for that in our use case.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*co0FeiTKnIAztY32" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*co0FeiTKnIAztY32" alt="Crawler Security" class="lazyload" data-proofer-ignore></a></p><h3 id="step-4--crawler-output-configuration"><span class="mr-2">Step 4 — Crawler Output Configuration</span><a href="#step-4--crawler-output-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This part is important so let me break it down for you:</p><ul><li>First, we need to tell the crawler which AWS Glue catalog database to add new tables to/update tables in. I already have one but in case you don’t, you can click on the Add Database option and move forward with these steps once your database is ready.<li>Then, we need to tell the crawler to group together all files that follow a similar schema into a single table. This is probably the most IMPORTANT configuration for our use case since we want to aggregate the results from multiple files.<li>Finally, we set the schedule frequency to On Demand. Since these crawlers mostly work together with ETL pipelines, AWS Glue gives you the option to run crawlers as cron jobs. However, since we just want our table to be updated when we run a test, we set it to On Demand.</ul><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9EwRzFKSXXa_yliP" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9EwRzFKSXXa_yliP" alt="Crawler Output" class="lazyload" data-proofer-ignore></a></p><p>Once we’re done reviewing our details, we can proceed with the creation of the crawler, where we’re taken to that crawler. To run the crawler, we can click on Run Crawler on the top right.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G4eeADo8j3EPTLmr" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G4eeADo8j3EPTLmr" alt="Newly Created Crawler" class="lazyload" data-proofer-ignore></a></p><hr /><p>Once our crawler has successfully crawled the Amazon S3 bucket, you will be able to see the status Completed for the latest run in the Crawler Runs section.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c0Qxwuxiv0RUaz-7" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c0Qxwuxiv0RUaz-7" alt="Crawler Runs" class="lazyload" data-proofer-ignore></a></p><p>Now, we should be good to go and query our logs using Amazon Athena! However, before moving, we need to confirm if our crawler was successful. To do this, we can click on Tables under the Data Catalog section of the AWS Glue console.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GQNxUB-L-FnrXlVi" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GQNxUB-L-FnrXlVi" alt="Glue Tables" class="lazyload" data-proofer-ignore></a></p><p>One last thing we can do before moving on is to check if our crawler inferred the schema correctly. To do this, we can click on the table and check the Schema section. And voila! The deed is done. We have response_size and response_time as query-able attributes.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KPkvw7HmtluXeQ0O" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KPkvw7HmtluXeQ0O" alt="Table Schema" class="lazyload" data-proofer-ignore></a></p><p>Well, that took quite a few clicks didnt it? I would say it took about as much effort as my friend puts into combining files and then querying them in Microsoft Excel, every time she runs a test. However, the good thing about this setup is that it only has to be done once. Now that we’ve created our crawler, my friend only needs to run it everytime she runs her tests and she’s good to go.</p><p>Oops. I almost forgot the querying part. Off to Amazon Athena!</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*40tMCOLsbsUaiIK1" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*40tMCOLsbsUaiIK1" alt="Search for Athena" class="lazyload" data-proofer-ignore></a></p><p>And… Here it is! Our query editor.</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*waUw9cTZmYWhMQRP" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*waUw9cTZmYWhMQRP" alt="Athena Query Editor" class="lazyload" data-proofer-ignore></a></p><p>We make sure that AWSDataCatalog is selected as the Data source and our AWS Glue catalog database is selected as the Database. Now, my friend can run a query as simple as</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">response_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">average_response_time</span>
<span class="k">FROM</span> <span class="nv">"blog-catalog"</span><span class="p">.</span><span class="nv">"responses"</span>
<span class="k">WHERE</span> <span class="n">response_size</span> <span class="o">=</span> <span class="mi">1048000</span><span class="p">;</span>
</pre></table></code></div></div><p>to analyze her test results!</p><p><a href="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f34qJQb9yC6g40Nl" class="popup img-link "><img data-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f34qJQb9yC6g40Nl" alt="Average Response Time" class="lazyload" data-proofer-ignore></a></p><p>Or maybe, she could run the following to also get a count for the number of records that account for the average value:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">SELECT</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">successful_responses</span><span class="p">,</span>
    <span class="k">AVG</span><span class="p">(</span><span class="n">response_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">average_response_time</span>
<span class="k">FROM</span> <span class="nv">"blog-catalog"</span><span class="p">.</span><span class="nv">"responses"</span>
<span class="k">WHERE</span> <span class="n">response_size</span> <span class="o">=</span> <span class="mi">1048000</span><span class="p">;</span>
</pre></table></code></div></div><hr /><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that you’ve seen how powerful AWS Glue and Amazon Athena are when paired up together, I’m sure you’ll also utilize them for basic log aggregation.</p><p>Honestly, the use cases of these services are endless and go far beyond going over logs that have 2 attributes and calculating the average. Both AWS Glue and Amazon Athena are probably the most-used cloud services by data engineers for big data processing.</p><p>AWS Glue allows you to create, schedule and run ETL jobs on the go, without having to manage the overhead of Apache Spark clusters. Amazon Athena, while maybe not as powerful as Apache Hive, gives you a major chunk of Apache Hive’s functionality while allowing you to focus more on data engineering than managing the infrastructure. Also, did I mention that Amazon Athena integrates with existing Apache Hive clusters like jam and bread?</p><p>I just started my journey as a data engineer a few months ago and honestly, there’s so much to learn. AWS has made it easier for me to focus more on learning data engineering concepts than to worry about setups and troubleshooting installation failures. So, if you’re also someone like me looking to get into the fascinating world of big data, I’d definitely recommend having AWS-managed services as your go-to!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogs/'>Blogs</a>, <a href='/categories/data-engineering/'>Data Engineering</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/data-engineering/" class="post-tag no-text-decoration" >data engineering</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/cloud-computing/" class="post-tag no-text-decoration" >cloud computing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Distrubuted%20Log%20Aggregation%20Using%20SQL%20-%20Abdullah%20Irfan&url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FDistrubuted-Log-Aggregation-Using-SQL%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Distrubuted%20Log%20Aggregation%20Using%20SQL%20-%20Abdullah%20Irfan&u=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FDistrubuted-Log-Aggregation-Using-SQL%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FDistrubuted-Log-Aggregation-Using-SQL%2F&text=Distrubuted%20Log%20Aggregation%20Using%20SQL%20-%20Abdullah%20Irfan" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FDistrubuted-Log-Aggregation-Using-SQL%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloud-computing/">cloud computing</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/for-dummies/">for dummies</a> <a class="post-tag" href="/tags/iaas/">IaaS</a> <a class="post-tag" href="/tags/network-security/">network security</a> <a class="post-tag" href="/tags/abstraction/">abstraction</a> <a class="post-tag" href="/tags/aspdotnet/">aspdotnet</a> <a class="post-tag" href="/tags/attacks/">attacks</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Built-Your-Very-Own-Cloud-Storage-Right-Now!/"><div class="card-body"> <em class="small" data-ts="1683666000" data-df="ll" > May 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build your Very Own Cloud Storage Right Now!</h3><div class="text-muted small"><p> Introduction When working in an organization or as a freelancer, one always faces an issue with file storage. There are millions of documents, images and important files that you need to store and ...</p></div></div></a></div><div class="card"> <a href="/posts/Instant-Cloud-VMs-With-a-cURL-Command/"><div class="card-body"> <em class="small" data-ts="1707204540" data-df="ll" > Feb 6, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Instant Cloud VMs With a cURL Command</h3><div class="text-muted small"><p> Cloud computing has been around for a while, and we all know its basics. Some things are easy to navigate around, and some aren’t, but I think we should all agree upon the fact that the consoles ...</p></div></div></a></div><div class="card"> <a href="/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/"><div class="card-body"> <em class="small" data-ts="1741726800" data-df="ll" > Mar 12, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Fix API Gateway Timeout Errors with Bedrock Agent Invocations</h3><div class="text-muted small"><p> Ever since GenAI took over the tech landscape, everyone is trying to jump onto the bandwagon - some aimlessly while others trying to squeeze out the maximum potential for operational efficiency and...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Polymorphism-Hidden-in-Plain-Sight/" class="btn btn-outline-primary" prompt="Older"><p>Polymorphism Hidden in Plain Sight?</p></a> <a href="/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/" class="btn btn-outline-primary" prompt="Newer"><p>Fix API Gateway Timeout Errors with Bedrock Agent Invocations</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloud-computing/">cloud computing</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/for-dummies/">for dummies</a> <a class="post-tag" href="/tags/iaas/">IaaS</a> <a class="post-tag" href="/tags/network-security/">network security</a> <a class="post-tag" href="/tags/abstraction/">abstraction</a> <a class="post-tag" href="/tags/aspdotnet/">aspdotnet</a> <a class="post-tag" href="/tags/attacks/">attacks</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://github.com/dingavinga1">Abdullah Irfan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
