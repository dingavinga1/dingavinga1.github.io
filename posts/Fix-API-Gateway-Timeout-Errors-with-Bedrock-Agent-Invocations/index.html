<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Fix API Gateway Timeout Errors with Bedrock Agent Invocations" /><meta property="og:locale" content="en" /><meta name="description" content="Ever since GenAI took over the tech landscape, everyone is trying to jump onto the bandwagon - some aimlessly while others trying to squeeze out the maximum potential for operational efficiency and cost savings. Amazon Web Services (AWS) is arguably the top cloud services provider in the world right now, and it seems like they’ve also got a pretty good grip on providing GenAI services to their customers, mostly via a service called Amazon Bedrock." /><meta property="og:description" content="Ever since GenAI took over the tech landscape, everyone is trying to jump onto the bandwagon - some aimlessly while others trying to squeeze out the maximum potential for operational efficiency and cost savings. Amazon Web Services (AWS) is arguably the top cloud services provider in the world right now, and it seems like they’ve also got a pretty good grip on providing GenAI services to their customers, mostly via a service called Amazon Bedrock." /><link rel="canonical" href="https://dingavinga1.github.io/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/" /><meta property="og:url" content="https://dingavinga1.github.io/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/" /><meta property="og:site_name" content="Abdullah Irfan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-03-12T02:00:00+05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Fix API Gateway Timeout Errors with Bedrock Agent Invocations" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-03-12T02:00:00+05:00","datePublished":"2025-03-12T02:00:00+05:00","description":"Ever since GenAI took over the tech landscape, everyone is trying to jump onto the bandwagon - some aimlessly while others trying to squeeze out the maximum potential for operational efficiency and cost savings. Amazon Web Services (AWS) is arguably the top cloud services provider in the world right now, and it seems like they’ve also got a pretty good grip on providing GenAI services to their customers, mostly via a service called Amazon Bedrock.","headline":"Fix API Gateway Timeout Errors with Bedrock Agent Invocations","mainEntityOfPage":{"@type":"WebPage","@id":"https://dingavinga1.github.io/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/"},"url":"https://dingavinga1.github.io/posts/Fix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations/"}</script><title>Fix API Gateway Timeout Errors with Bedrock Agent Invocations | Abdullah Irfan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Abdullah Irfan"><meta name="application-name" content="Abdullah Irfan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Abdullah Irfan</a></div><div class="site-subtitle font-italic">AI Data Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/dingavinga1" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['abdullahirfan2001','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://linkedin.com/in/dingavinga" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Fix API Gateway Timeout Errors with Bedrock Agent Invocations</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Fix API Gateway Timeout Errors with Bedrock Agent Invocations</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1741726800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 12, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/dingavinga1">Abdullah Irfan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1131 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Ever since GenAI took over the tech landscape, everyone is trying to jump onto the bandwagon - some aimlessly while others trying to squeeze out the maximum potential for operational efficiency and cost savings. Amazon Web Services (AWS) is arguably the top cloud services provider in the world right now, and it seems like they’ve also got a pretty good grip on providing GenAI services to their customers, mostly via a service called Amazon Bedrock.</p><p>Amazon Bedrock allows customers to pick from a wide range of foundational LLMs, tailoring them to their own use-cases using fine-tuning, continual pre-training, retrieval augmented generation (RAG) and agents, while also providing essential helper features like guardrails to filter out harmful requests and responses. Talking about Amazon Bedrock doesn’t only unlock a chapter in a book, it is the whole book. So, for the sake of this blog, let’s briefly go over agents. What are they?</p><p>Everyone has been having their fair share of fun with generative AI-powered chatbots, and they’re a positive addition to the consumer market. However, limiting ourselves to using LLMs for basic Q&amp;A tasks is equivalent to buying a Bugatti Chiron and driving it at 80 km/h on the German Autobahn.</p><p>LLMs come with a not-so-hidden gem - reasoning capabilities. While these capabilities do stem from the vast knowledge they have about virtually everything one can imagine, it is that same knowledge that allows them to reason well. These reasoning capabilities open new doors for probably every industry that uses technology. We can open these doors by automating repetitive tasks using these capabilities.</p><p>Talking about the technicalities of how LLMs can be used as agents to automate workflows is a topic for another blog. For now, just know that Amazon Bedrock provides a feature called “Agents for Amazon Bedrock”, which takes away most of the technicalities from you and allows you to focus on the automation part.</p><p>When we ask ChatGPT a question, it responds almost instantaneously. Right? This is because ChatGPT is matching your query to the best possible answers and displaying them to you and that is the simplest use-case for LLMs. However, when it comes to agents, there’s a lot more going on. An LLM is being called multiple times, with dynamic knowledge from possibly multiple sources. This results in delayed responses, sometimes taking up to 2 minutes.</p><p>In a usual request-response scenario, we’d invoke an LLM using an AWS Lambda function with proxy integration with Amazon API Gateway.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/ideal-architecture.png?raw=true" alt="Ideal Architecture" class="lazyload" data-proofer-ignore></a></p><p>This way, we’d be able to make an HTTP request to an endpoint and receive a response, and it’d be quite the cost-effective solution. However, the problem with this architecture is the <code class="language-plaintext highlighter-rouge">29s</code> timeout in Amazon API Gateway. When invoking agents, this timeout is often hit, resulting in a bad user experience and loss of data. If you want Amazon Bedrock and AWS Lambda to be a constant in a similar scenario, web sockets are the answer.</p><p>As opposed to simple HTTP requests, web sockets allow full-duplex connections between a server and clients. This allows asynchronous communication and eliminates the need to tackle request timeouts. Using web sockets usually requires a server being set up to allow connections over the web socket protocol. However, Amazon API Gateway takes all your troubles away by allowing native web socket integration with AWS Lambda. This means you get to reap the benefits of serverless asynchronous communication between users and agents. Let’s get to how we can achieve this.</p><h2 id="set-up"><span class="mr-2">Set Up</span><a href="#set-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="step-1---creating-the-lambda-function"><span class="mr-2">Step 1 - Creating the Lambda Function</span><a href="#step-1---creating-the-lambda-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we need a Lambda function that is triggered by a web socket command and invokes a Bedrock agent. For that, we can use the following code snippet:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">request_context</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">requestContext</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">request_context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">routeKey</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">command</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">"</span><span class="s">$connect</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">$disconnect</span><span class="sh">"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">statusCode</span><span class="sh">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="sh">"</span><span class="s">$default</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">request_context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">connectionId</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">parsed_body</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">parsed_body</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">parsed_body</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="nf">invoke_agent</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>

            <span class="n">domain_name</span> <span class="o">=</span> <span class="n">request_context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">domainName</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="n">request_context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">stage</span><span class="sh">"</span><span class="p">)</span>

            <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">apigatewaymanagementapi</span><span class="sh">'</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">https://</span><span class="si">{</span><span class="n">domain_name</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="nf">post_to_connection</span><span class="p">(</span><span class="n">ConnectionId</span><span class="o">=</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">Data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>

            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">statusCode</span><span class="sh">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">statusCode</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span><span class="p">}</span>
</pre></table></code></div></div><blockquote><p>The <code class="language-plaintext highlighter-rouge">invoke_agent</code> function is a self-written function that invokes the Bedrock agent using <code class="language-plaintext highlighter-rouge">boto3</code>.</p></blockquote><p>This lambda function receives an event dictionary according to the specification defined in <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-websocket-api-integration-requests.html">Set up a WebSocket API integration request in API Gateway</a> and handles web socket connections, using the <code class="language-plaintext highlighter-rouge">$default</code> command as a trigger for agent invocation.</p><p>That’s not it for the Lambda function. We need to assign permissions for:</p><ul><li>API Gateway management<li>Bedrock agent invocation</ul><p>The Lambda execution role should look something like this:</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/lambda-permissions.png?raw=true" alt="Lambda role" class="lazyload" data-proofer-ignore></a></p><p>The <code class="language-plaintext highlighter-rouge">AmazonAPIGatewayInvokeFullAccess</code> policy is an AWS-managed policy that allows management and invocation of the API Gateway service. <code class="language-plaintext highlighter-rouge">BedrockInvokeAgent</code> is a policy I created to allow the Lambda function to invoke our Bedrock agent, and it looks like this:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
	</span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
		</span><span class="p">{</span><span class="w">
			</span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bedrock:InvokeAgent"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:bedrock:us-east-1:&lt;ACCOUNT ID&gt;:agent-alias/&lt;AGENT ID&gt;/*"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="w">
		</span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>With these permissions being set, our Lambda function is ready for invocation.</p><h3 id="step-2---setting-up-a-web-socket-api-using-amazon-api-gateway"><span class="mr-2">Step 2 - Setting up a Web Socket API using Amazon API Gateway</span><a href="#step-2---setting-up-a-web-socket-api-using-amazon-api-gateway" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, we need to create an API that allows web socket connections via Amazon API Gateway. To do this, we can go to the AWS Management Console, navigate to the Amazon API Gateway service console and click on <code class="language-plaintext highlighter-rouge">Create API</code>. Now, we can select the <code class="language-plaintext highlighter-rouge">Websocket API</code> option from the list and click on <code class="language-plaintext highlighter-rouge">Build</code>.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/web-socket-option.png?raw=true" alt="Websocket Option" class="lazyload" data-proofer-ignore></a></p><p>Then, we can give our API a name and use the default action.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/api-details.png?raw=true" alt="API Details" class="lazyload" data-proofer-ignore></a></p><p>Next up, we need to add all 3 pre-defined routes to our API (<code class="language-plaintext highlighter-rouge">$connect</code>, <code class="language-plaintext highlighter-rouge">$disconnect</code> and <code class="language-plaintext highlighter-rouge">$default</code>).</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/api-routes.png?raw=true" alt="API Routes" class="lazyload" data-proofer-ignore></a></p><p>Then, we need to assign our previously created Lambda function as an integration for all three routes.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/api-integrations.png?raw=true" alt="API Integrations" class="lazyload" data-proofer-ignore></a></p><p>Finally, we can create a stage for our API and finalize the creation.</p><h2 id="testing"><span class="mr-2">Testing</span><a href="#testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once we’re done with the setup, we can navigate to the <code class="language-plaintext highlighter-rouge">Stages</code> section of our newly created API and copy the websocket URL.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/api-stage.png?raw=true" alt="API Stage" class="lazyload" data-proofer-ignore></a></p><p>We can use the <code class="language-plaintext highlighter-rouge">wscat</code> tool to test our API out.</p><p><a href="true" class="popup img-link "><img data-src="https://github.com/abdullahirfann/apigateway-websocket-integration/blob/main/assets/wscat.png?raw=true" alt="Wscat" class="lazyload" data-proofer-ignore></a></p><p>Now we know that our setup works, and we can go ahead and integrate this with our frontend to allow our users to communicate with the agent, without facing any timeout errors!</p><hr /><p>Since we’re at the end of our blog, I’d like to give everyone a reminder that <strong><em>“where there’s a will, there’s a way”</em></strong>. I hope this helps anyone who has been facing the same issue as me. <a href="./template.yaml">Here’s</a> a starter CloudFormation template you can use to get this setup running in just a single click. Just pass the agent ID, agent alias ID, memory ID and ARN as parameters, and you’re good to go!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogs/'>Blogs</a>, <a href='/categories/cloud-computing/'>Cloud Computing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cloud-computing/" class="post-tag no-text-decoration" >cloud computing</a> <a href="/tags/genai/" class="post-tag no-text-decoration" >genai</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Fix%20API%20Gateway%20Timeout%20Errors%20with%20Bedrock%20Agent%20Invocations%20-%20Abdullah%20Irfan&url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FFix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Fix%20API%20Gateway%20Timeout%20Errors%20with%20Bedrock%20Agent%20Invocations%20-%20Abdullah%20Irfan&u=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FFix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FFix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations%2F&text=Fix%20API%20Gateway%20Timeout%20Errors%20with%20Bedrock%20Agent%20Invocations%20-%20Abdullah%20Irfan" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fdingavinga1.github.io%2Fposts%2FFix-API-Gateway-Timeout-Errors-with-Bedrock-Agent-Invocations%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloud-computing/">cloud computing</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/for-dummies/">for dummies</a> <a class="post-tag" href="/tags/iaas/">IaaS</a> <a class="post-tag" href="/tags/network-security/">network security</a> <a class="post-tag" href="/tags/abstraction/">abstraction</a> <a class="post-tag" href="/tags/aspdotnet/">aspdotnet</a> <a class="post-tag" href="/tags/attacks/">attacks</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Built-Your-Very-Own-Cloud-Storage-Right-Now!/"><div class="card-body"> <em class="small" data-ts="1683666000" data-df="ll" > May 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build your Very Own Cloud Storage Right Now!</h3><div class="text-muted small"><p> Introduction When working in an organization or as a freelancer, one always faces an issue with file storage. There are millions of documents, images and important files that you need to store and ...</p></div></div></a></div><div class="card"> <a href="/posts/Instant-Cloud-VMs-With-a-cURL-Command/"><div class="card-body"> <em class="small" data-ts="1707204540" data-df="ll" > Feb 6, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Instant Cloud VMs With a cURL Command</h3><div class="text-muted small"><p> Cloud computing has been around for a while, and we all know its basics. Some things are easy to navigate around, and some aren’t, but I think we should all agree upon the fact that the consoles ...</p></div></div></a></div><div class="card"> <a href="/posts/Distrubuted-Log-Aggregation-Using-SQL/"><div class="card-body"> <em class="small" data-ts="1732482000" data-df="ll" > Nov 25, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Distrubuted Log Aggregation Using SQL</h3><div class="text-muted small"><p> I was talking to a friend recently and she happens to be a performance test engineer. It had been a stressful day for her because it took her an entire day to analyze some performance results. You ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Distrubuted-Log-Aggregation-Using-SQL/" class="btn btn-outline-primary" prompt="Older"><p>Distrubuted Log Aggregation Using SQL</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cloud-computing/">cloud computing</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/for-dummies/">for dummies</a> <a class="post-tag" href="/tags/iaas/">IaaS</a> <a class="post-tag" href="/tags/network-security/">network security</a> <a class="post-tag" href="/tags/abstraction/">abstraction</a> <a class="post-tag" href="/tags/aspdotnet/">aspdotnet</a> <a class="post-tag" href="/tags/attacks/">attacks</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://github.com/dingavinga1">Abdullah Irfan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
